package main

import (
	"bufio"
	"fmt"
	"log"
	"os"
	"strconv"
	"strings"
)

func Day7_copy() {
	inputText, err := os.Open("input/day7.txt")
	if err != nil {
		log.Fatal(err)
	}

	defer inputText.Close()

	scanner := bufio.NewScanner(inputText)

	directoryValue := make(map[string]int)
	directorySum := make(map[string]int)
	directoryContains := make(map[string][]string)

	currentDirectory := ""
	totalSum := 0

	for scanner.Scan() {
		input := strings.Fields(scanner.Text())
		if input[0] == "$" && input[1] == "cd" {
			if input[2] == ".." {
				currentDirectory = strings.Join(strings.Fields(currentDirectory)[:len(strings.Fields(currentDirectory))-1], " ")
			} else {
				if currentDirectory == "" {
					currentDirectory = input[2]
				} else {
					currentDirectory += " " + input[2]
				}
			}
		} else if input[0] == "$" {
			//probably ignore because its a ls
		} else if input[0] == "dir" {
			//do mapping
			directoryContains[currentDirectory] = append(directoryContains[currentDirectory], currentDirectory+" "+input[1])
		} else {
			//its a number
			size, _ := strconv.Atoi(input[0])
			directoryValue[currentDirectory] += size
		}
	}
	// fmt.Println(directoryContains)
	// fmt.Println(directoryValue)

	for mainDir, listOfSubDir := range directoryContains {
		for _, dir := range listOfSubDir {
			directorySum[mainDir] += iterateSubDir_copy(directoryValue, directoryContains, directorySum, dir)
		}
	}

	for _, dirSum := range directorySum {
		if dirSum <= 100000 {
			totalSum += dirSum
		}
	}
	fmt.Println(directorySum)
	fmt.Println("total sum", totalSum)

	// fmt.Println(directoryValue["/"])

	// valueToDelete := 70000000
	// spaceRequired := 30000000 - (70000000 - 47870454)

	// for _, dirSum := range directoryValue {
	// 	if dirSum < valueToDelete && dirSum > spaceRequired {
	// 		valueToDelete = dirSum
	// 	}
	// }
	// fmt.Println(valueToDelete)

}

func iterateSubDir_copy(Value map[string]int, Contains map[string][]string, Sum map[string]int, directory string) (dirSum int) {
	dirSum = 0
	// fmt.Println(directory)
	//fmt.Println("call with", directory)
	if _, subDirFound := Contains[directory]; subDirFound {
		for _, subDir := range Contains[directory] {
			dirSum += iterateSubDir_copy(Value, Contains, Sum, subDir)
		}
	} else {
		return Value[directory]
	}
	return
}

//1149424 too low
//1257239 too low
//1571315 too low

//47870454 possible total size

//8583399 too low
//8652144 too low
//8934862 too low
//9724718 uknown
